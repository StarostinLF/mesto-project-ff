(()=>{"use strict";var e={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-2",headers:{authorization:"ed383b99-1870-4886-8866-3d44839ba706","Content-Type":"application/json"}};function t(){return fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function n(t,n,r){var o=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),c=o.querySelector(".card__image"),a=o.querySelector(".card__title"),u=o.querySelector(".card__like-button"),i=o.querySelector(".card__like-counter"),s=o.querySelector(".card__delete-button");return c.src=t.link,c.alt=t.name,a.textContent=t.name,i.textContent=t.likes.length,t.likes.some((function(e){return e._id===n}))?u.classList.add("card__like-button_is-active"):u.classList.remove("card__like-button_is-active"),c.addEventListener("click",r),u.addEventListener("click",(function(){var n;u.classList.contains("card__like-button_is-active")?((n=t._id,fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){return i.textContent=e.likes.length})).catch((function(e){return console.error("Ошибка при добавлении карточки:",e)})),u.classList.remove("card__like-button_is-active")):(function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t._id).then((function(e){return i.textContent=e.likes.length})).catch((function(e){return console.error("Ошибка при добавлении карточки:",e)})),u.classList.add("card__like-button_is-active"))})),t.owner._id===n?(s.addEventListener("click",(function(){var n;n=t._id,fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),o.remove()})),s.style.display="block"):s.style.display="none",o}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function c(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}function a(e,t){e.closest(".popup__form").querySelector('[data-error="'.concat(e.name,'"]')).textContent=t}function u(e){e.closest(".popup__form").querySelector('[data-error="'.concat(e.name,'"]')).textContent=""}function i(e,t){e?(t.removeAttribute("disabled"),t.classList.remove("popup__button_disabled")):(t.setAttribute("disabled",!0),t.classList.add("popup__button_disabled"))}function s(e){var t=e.querySelectorAll(".popup__input"),n=e.querySelector(".popup__button");t.forEach((function(e){return u(e)})),i(!1,n)}var l=document.querySelector(".places__list"),p=document.querySelector(".profile"),d=p.querySelector(".profile__id"),_=p.querySelector(".profile__image"),f=p.querySelector(".profile__edit-button"),m=p.querySelector(".profile__title"),y=p.querySelector(".profile__description"),h=p.querySelector(".profile__add-button"),v=document.querySelector('.popup__form[name="avatar"]'),b=v.querySelector(".popup__input_type_url"),S=document.querySelector('.popup__form[name="edit-profile"]'),q=S.querySelector(".popup__input_type_name"),k=S.querySelector(".popup__input_type_description"),L=document.querySelector('.popup__form[name="new-place"]'),E=L.querySelector(".popup__input_type_card-name"),C=L.querySelector(".popup__input_type_url"),g=document.querySelectorAll(".popup"),x=document.querySelector(".popup_type_edit_avatar"),j=document.querySelector(".popup_type_edit"),P=document.querySelector(".popup_type_new-card"),U=document.querySelector(".popup_type_image"),A=U.querySelector(".popup__image"),w=U.querySelector(".popup__caption");function T(e){var t=e.target.closest(".card"),n=t.querySelector(".card__image"),o=t.querySelector(".card__title");A.src=n.src,A.alt=o.alt,w.textContent=o.textContent,r(U)}t().then((function(e){_.style.backgroundImage="url(\\".concat(e.avatar,")"),d.textContent=e._id,m.textContent=e.name,y.textContent=e.about})).catch((function(e){return console.error("Ошибка при получении данных пользователя:",e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){l.append(n(e,d.textContent,T))}))})).catch((function(e){return console.error("Ошибка при загрузке начальных карточек:",e)})),v.addEventListener("submit",(function(t){var n;t.preventDefault(),(n=b.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){_.style.backgroundImage="url(\\".concat(e.avatar,")")})).catch((function(e){return console.error("Ошибка при получении данных пользователя:",e)})),s(v),o(x)})),S.addEventListener("submit",(function(t){var n,r;t.preventDefault(),m.textContent=q.value,y.textContent=k.value,n=m.textContent,r=y.textContent,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),s(S),o(j)})),L.addEventListener("submit",(function(t){var r,c;t.preventDefault(),(r=E.value,c=C.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:c})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=n(e,d.textContent,T);l.prepend(t)})).catch((function(e){return console.error("Ошибка при добавлении карточки:",e)})),s(L),o(P),L.reset()})),_.addEventListener("click",(function(){t().then((function(e){return b.value=e.avatar})).catch((function(e){return console.error("Ошибка при получении данных пользователя:",e)})),r(x)})),f.addEventListener("click",(function(){q.value=m.textContent,k.value=y.textContent,r(j)})),h.addEventListener("click",(function(){return r(P)})),g.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.matches(".popup_is-opened, .popup__close")&&o(e)}))})),document.querySelectorAll(".popup__form").forEach((function(e){return function(e){e.addEventListener("input",(function(t){var n=t.target,r=e.checkValidity(),o=e.querySelector(".popup__button");!function(e){e.validity.valueMissing?(a(e,"Это обязательное поле"),e.classList.add("popup__input_border-is-red")):e.validity.patternMismatch?(a(e,e.title),e.classList.add("popup__input_border-is-red")):(u(e),e.classList.remove("popup__input_border-is-red"))}(n),i(r,o)})),e.addEventListener("reset",(function(){var t=e.querySelectorAll(".popup__input"),n=e.querySelector(".popup__button");t.forEach((function(e){return u(e)})),i(!1,n)}))}(e)})),s(v),s(S),s(L)})();